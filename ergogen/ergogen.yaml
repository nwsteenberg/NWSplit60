units:
  padding: 5

  shellThickness: 2
  plateHeight: 1.6 # MX Key plate height (Ideal. Probably 1.6 if using PCB plate)
  topOfPlateToTopOfPCBSwitchHeight: 5 - plateHeight # 5mm between top of plate and top of Keyboard PCB
  pcbHeight: 1.6 # Keyboard PCB
  componentHeight: 3 # total with connectors and everything (closer to 5 but we want some more room)
  baseHeight: 1.5 # 3d Printed case bottom height

  topOfShellToTopOfPlate: 5
  wallHeight: topOfShellToTopOfPlate + plateHeight + topOfPlateToTopOfPCBSwitchHeight + pcbHeight + componentHeight + baseHeight
  standoffHeightBase: componentHeight + baseHeight # Standoffs should account for MCU height
  standoffHeightShell: topOfShellToTopOfPlate 

  wallExpander: 4 # buffer between wall and pcb/plate
  tolerance: 0.5

  standoffSize: 4 # Radius of standoff (outer)
  screwSize: 1.5 # Radius of insert
points:
  zones:
    matrix:
      anchor:
        shift: [40, -200] # Move into KiCAD position
        rotate: 0
      columns:
        reachy.key.mirror.skip: false
        #reachy.rows.bottom.mirror.skip: true
        reachy.key.skip: true
        reachy.key.column_net: "GP9"
        
        #outer.rows.num.mirror.skip: false
        #outer.rows.num.skip: true
        outer.key.column_net: "GP8"
        
        pinky.key.column_net: "GP7"
        
        ring.key.stagger: 0.2U
        ring.key.column_net: "GP6"
        
        middle.key.stagger: 0.1U
        middle.key.column_net: "GP5"
        middle.rows.home.bind: [2.2U,3.2U,2.2U,3.2U]
        middle.rows.home.mirror.bind: [2.2U,3.2U,2.2U,4.2U]

        index.key.stagger: -0.2U
        index.key.column_net: "GP4"
        
        inner.key.stagger: -0.1U
        inner.key.column_net: "GP3"
        
        stretch.rows.num.skip: true
        stretch.rows.top.skip: true
        stretch.rows.home.skip: true
        stretch.rows.home.adjust.shift: [0,0.75U]
        stretch.rows.home.height: 1.5U
        stretch.rows.bottom.skip: false
        #stretch.rows.bottom.adjust.shift: [0,0.25U]
        stretch.rows.bottom.adjust.shift: [0,0.5U]
        stretch.rows.bottom.height: 1.5U
        stretch.key.column_net: "GP2"
      rows:
        bottom.padding: U
        bottom.row_net: "GP15"
        home.padding: U
        home.row_net: "GP26"
        top.padding: U
        top.row_net: "GP27"
        num.padding: U
        num.row_net: "GP28"
    thumb:
      anchor:
        ref: matrix_inner_bottom
        shift: [-0.5U, -1.2U]
      columns:
        tuck:
          key.name: matrix_thumb_tuck
          key.column_net: "GP4"
          key.bind: [1U,1U,0U,0U]
        center:
          key.name: matrix_thumb_center
          key.splay: -30
          key.origin: [-0.5U, -0.5U]
          key.height: 1.5U
          key.adjust.shift: [0, 0.25U]
          key.column_net: "GP3"
          key.bind: [0.25U+(padding/2),padding/2,0.25U+(padding/2),1U]
        reach:
          key.name: matrix_thumb_reach
          key.origin: [-0.5U, -0.5U]
          key.column_net: "GP2"
          key.height: 1.5U
          key.adjust.shift: [0, 0.25U]
          key.bind: [0.25U+(padding/2),padding/2,0.25U+(padding/2),0U]
      rows:
        only:
          row_net: "GP14"

  mirror:
    ref: matrix_pinky_home
    distance: 270

outlines:
  _outline: # Starting outline of Keyboard
    - what: rectangle
      where: /.atrix_middle_home/
      bound: true
      fillet: 3
      size: U
    - what: rectangle
      where: /.atrix_thumb/
      bound: true
      size: U
    - what: rectangle
      where: true
      size: U+padding
  outline:  # With a wallExpander
    - what: outline
      name: _outline
      expand: wallExpander
  _mcu_hole:
    - what: rectangle
      where: /.atrix_middle_home/
      size: [21, 28]
      adjust.shift: [59, 44.5]
  _trrs_rep:
    - what: rectangle
      where: /.atrix_middle_home/
      size: [16+1, 6+1]
      adjust:
        shift: [67.5,14] 
  _mx_cutout:
    - what: rectangle
      size: 14

  _holes_holding_shell: 
    # Left
  - what: circle
    radius: screwSize
    where:
      ref: matrix_outer_num
      shift: [-0.4U, 0.8U]
  - what: circle
    radius: screwSize
    where:
      ref: matrix_inner_num
      shift: [0U, 0.8U]
  - what: circle
    radius: screwSize
    where:
      ref: matrix_thumb_tuck
      shift: [-0.8U, 0.1U]
  - what: circle
    radius: screwSize
    where:
      ref: matrix_thumb_tuck
      shift: [-4.9U, 0.4U]
  - what: circle
    radius: screwSize
    where:
      ref: matrix_thumb_center
      shift: [0.2U, 1U]
  - what: circle
    radius: screwSize
    where:
      ref: matrix_stretch_bottom
      shift: [0.2U, 1U]
    # right
  - what: circle
    radius: screwSize
    where:
      ref: mirror_matrix_reachy_num
      shift: [-0.4U, 0.8U]
  - what: circle
    radius: screwSize
    where:
      ref: mirror_matrix_inner_num
      shift: [0U, 0.8U]
  - what: circle
    radius: screwSize
    where:
      ref: mirror_matrix_thumb_tuck
      shift: [-0.8U, 0.1U]
  - what: circle
    radius: screwSize
    where:
      ref: mirror_matrix_thumb_tuck
      shift: [-5.9U, 0.4U]
  - what: circle
    radius: screwSize
    where:
      ref: mirror_matrix_thumb_center
      shift: [0.2U, 1U]
  - what: circle
    radius: screwSize
    where:
      ref: mirror_matrix_stretch_bottom
      shift: [0.2U, 1U]
  _holes_holding_base: 
    # Left
  - what: circle
    radius: screwSize
    where:
      ref: matrix_pinky_home
      shift: [-0.5U, 0.5U]
  - what: circle
    radius: screwSize
    where:
      ref: matrix_middle_home
      shift: [-0.5U, 0.5U]
  - what: circle
    radius: screwSize
    where:
      ref: matrix_inner_home
      shift: [-0.5U, 0.5U]
  - what: circle
    radius: screwSize
    where:
      ref: matrix_thumb_center
      shift: [0.5U, -0.2U]
    # right
  - what: circle
    radius: screwSize
    where:
      ref: mirror_matrix_pinky_home
      shift: [-0.5U, 0.5U]
  - what: circle
    radius: screwSize
    where:
      ref: mirror_matrix_middle_home
      shift: [-0.5U, 0.5U]
  - what: circle
    radius: screwSize
    where:
      ref: mirror_matrix_inner_home
      shift: [-0.5U, 0.5U]
  - what: circle
    radius: screwSize
    where:
      ref: mirror_matrix_thumb_center
      shift: [0.5U, -0.2U]

  plate: 
    - what: outline
      name: outline
    - what: outline
      name: _mcu_hole
      operation: subtract
    - what: outline
      name: _trrs_rep
      operation: subtract
    - what: outline
      name: _mx_cutout
      where: true
      operation: subtract
      fillet: 0.5

  _keys:
    - what: rectangle
      where: true
      size: 18
    - what: rectangle
      where: /.atrix_thumb_reach/
      size: [18, 27]
    - what: rectangle
      where: /.atrix_thumb_center/
      size: [18, 27]
    - what: rectangle
      where: /.atrix_stretch_/
      size: [18, 27]

  _keys_cutout:
    - what: rectangle
      where: /.atrix_thumb_tuck/
      size: [18+14, 18+8]
      adjust.shift: [7, 4]
    - what: outline
      name: _keys
      expand: 2

  _outline_left: 
  - what: outline
    name: outline
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: mirror_matrix_middle_home

  _outline_right: 
  - what: outline
    name: outline
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: matrix_middle_home

  _outline_left_buffer: 
  - what: outline
    name: outline
    expand: tolerance
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: mirror_matrix_middle_home

  _outline_right_buffer: 
  - what: outline
    name: outline
    expand: tolerance
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: matrix_middle_home

  outline_feet: 
  - what: outline
    name: outline
    expand: tolerance
  - what: rectangle
    size: [14, 58]
    where: /.atrix_stretch_bottom/
    operation: subtract
    adjust:
      shift: [6, -28]
  - what: rectangle
    size: [14, 58]
    where: /.atrix_stretch_bottom/
    operation: subtract
    adjust:
      shift: [6, 38]

  _outline_right_buffer_feet: 
  - what: outline
    name: outline_feet
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: matrix_middle_home

  _outline_left_buffer_feet: 
  - what: outline
    name: outline_feet
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: mirror_matrix_middle_home

  _outline_left_XL:
  - what: outline
    name: _outline_left_buffer
    expand: shellThickness

  _keys_XL:
  - what: outline
    name: _keys_cutout
    expand: 2
  - what: outline
    name: _keys_cutout
    operation: subtract

  _outline_left_walls:
  - what: outline
    name: _outline_left_XL
  - what: outline
    name: _outline_left_buffer
    operation: subtract

  _outline_left_keys:
  - what: outline
    name: _outline_left_XL
  - what: outline
    name: _keys_cutout
    operation: subtract

  _outline_right_XL:
  - what: outline
    name: _outline_right_buffer
    expand: shellThickness

  _outline_right_walls:
  - what: outline
    name: _outline_right_XL
  - what: outline
    name: _outline_right_buffer
    operation: subtract

  _outline_right_keys:
  - what: outline
    name: _outline_right_XL
  - what: outline
    name: _keys_cutout
    operation: subtract

  _plate_left: 
  - what: outline
    name: plate
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: mirror_matrix_middle_home

  _plate_right: 
  - what: outline
    name: plate
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: matrix_middle_home

  _standoffs_left_base: 
  - what: outline
    name: _holes_holding_base
    expand: standoffSize - screwSize
  - what: outline
    name: _holes_holding_base
    operation: subtract
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: mirror_matrix_middle_home

  _standoffs_left_shell: 
  - what: outline
    name: _holes_holding_shell
    expand: standoffSize - screwSize
  - what: outline
    name: _holes_holding_shell
    operation: subtract
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: mirror_matrix_middle_home

  _extrude_left_shell: 
  - what: outline
    name: _standoffs_left_shell
  - what: outline
    name: _keys_XL
  - what: outline
    name: _keys_cutout
    operation: subtract
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: mirror_matrix_middle_home

  _standoffs_right_base: 
  - what: outline
    name: _holes_holding_base
    expand: standoffSize - screwSize
  - what: outline
    name: _holes_holding_base
    operation: subtract
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: matrix_middle_home

  _standoffs_right_shell: 
  - what: outline
    name: _holes_holding_shell
    expand: standoffSize - screwSize
  - what: outline
    name: _holes_holding_shell
    operation: subtract
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: matrix_middle_home

  _extrude_right_shell: 
  - what: outline
    name: _standoffs_right_shell
  - what: outline
    name: _keys_XL
  - what: outline
    name: _keys_cutout
    operation: subtract
  - what: rectangle
    size: 10U
    operation: subtract
    where:
      ref: matrix_middle_home

  representation: # How will the keyboard look? 18 is the size of a complete MX key (unit: u)
    - what: outline
      name: outline
    - what: outline
      name: _keys
      operation: subtract

cases:
  left_base:
    - name: _outline_left_buffer_feet
      extrude: baseHeight
      shift: [0,0, -baseHeight]
    - name: _outline_left_buffer
      extrude: baseHeight  
    - name: _standoffs_left_base
      extrude: standoffHeightBase
    - name: _standoffs_left_shell
      extrude: standoffHeightBase
    - name: _holes_holding_shell
      operation: subtract
      extrude: 5 # Make holes go through base
      shift: [0,0, -baseHeight]
    - name: _standoffs_left_shell
      extrude: 0.6 # Indents on bottom of base for screws
      operation: subtract

  left_shell:
    - name: _outline_left_keys
      extrude: shellThickness
    - name: _extrude_left_shell
      extrude: standoffHeightShell
      shift: [0,0, shellThickness-standoffHeightShell]
    - name: _outline_left_walls
      extrude: wallHeight
      shift: [0,0, shellThickness-wallHeight]

  right_base:
    - name: _outline_right_buffer_feet
      extrude: baseHeight
      shift: [0,0, -baseHeight]
    - name: _outline_right_buffer
      extrude: baseHeight
    - name: _standoffs_right_base
      extrude: standoffHeightBase
    - name: _standoffs_right_shell
      extrude: standoffHeightBase
    - name: _holes_holding_shell
      operation: subtract
      extrude: 5 # Make holes go through base
      shift: [0,0, -baseHeight]
    - name: _standoffs_right_shell
      extrude: 0.6
      operation: subtract

  right_shell:
    - name: _outline_right_keys
      extrude: shellThickness
    - name: _extrude_right_shell
      extrude: standoffHeightShell
      shift: [0,0, shellThickness-standoffHeightShell]
    - name: _outline_right_walls
      extrude: wallHeight
      shift: [0,0, shellThickness-wallHeight]

pcbs:
  left:
    template: kicad8
    outlines:
      main:
        outline: _outline_left
    footprints:
      mx_hotswap:
        what: mx
        where: /^matrix/
        params:
          keycaps: true
          reverse: false
          hotswap: true
          from: "{{column_net}}"
          to: "{{colrow}}"
      diode:
        what: diode
        where: /^matrix/
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"
        adjust:
          shift: [0, -4.5]
      trrs:
        what: ceoloide/trrs_pj320a
        params:
          SL: GND #GND Recommended
          R1: GP0 #UART0 TX
          R2: GP1 #UART0 RX 
          TP: 3V3 #3v3 (OUT) Recommended
          side: "F"
        where: matrix_middle_home
        adjust:
          shift: [72.5, 14]
          rotate: 270
      mcu:
        what: waveshare-rp2040 #https://github.com/CountParadox/RP2040-Zero-Kicad/tree/main
        params:
        where:
          ref: matrix_middle_home
          shift: [49, 27+wallExpander]
      left_text:
        what: ceoloide/utility_text
        params:
          text: "LEFT SIDE"
          height: 3
          width: 3
        where:
          ref: matrix_inner_num
          shift: [1.15U, -0.4U]
      model:
        what: ceoloide/utility_text
        params:
          text: "NWSplit60"
          width: 2
          height: 2
        where:
          ref: matrix_thumb_center
          shift: [1.2U, 0.9U]
      nws_text:
        what: ceoloide/utility_text
        params:
          text: "NWS WAS HERE!"
          width: 2
          height: 2
        where:
          ref: matrix_thumb_center
          shift: [0.7U, -0.9U]
      # Holes
      hole1:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_pinky_home
          shift: [-0.5U, 0.5U]
      hole2:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_middle_home
          shift: [-0.5U, 0.5U]
      hole3:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_inner_home
          shift: [-0.5U, 0.5U]
      hole4:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_outer_num
          shift: [-0.4U, 0.8U]
      hole5:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_inner_num
          shift: [0U, 0.8U]
      hole6:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_thumb_tuck
          shift: [-0.8U, 0.1U]
      hole7:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_thumb_center
          shift: [0.5U, -0.2U]
      hole8:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_thumb_tuck
          shift: [-4.9U, 0.4U]
      hole9:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_thumb_center
          shift: [0.2U, 1U]
      hole10:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_stretch_bottom
          shift: [0.2U, 1U]

  right:
    template: kicad8
    outlines:
      main:
        outline: _outline_right
    footprints:
      mx_hotswap:
        what: mx
        where: /^mirror/
        params:
          keycaps: true
          reverse: false
          hotswap: true
          from: "{{column_net}}"
          to: "{{colrow}}"
      diode:
        what: diode
        where: /^mirror/
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"
        adjust:
          shift: [0, -4.5]
      trrs:
        what: ceoloide/trrs_pj320a
        params:
          SL: GND #GND Recommended
          R1: GP0 #UART0 TX
          R2: GP1 #UART0 RX 
          TP: 3V3 #3v3 (OUT) Recommended
          side: "F"
        where: mirror_matrix_middle_home
        adjust:
          shift: [72.5, 14]
          rotate: 270
      mcu:
        what: waveshare-rp2040 #https://github.com/CountParadox/RP2040-Zero-Kicad/tree/main
        params:
        where:
          ref: mirror_matrix_middle_home
          shift: [69, 27+wallExpander]
            # Holes
      hole1:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_pinky_home
          shift: [-0.5U, 0.5U]
      hole2:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_middle_home
          shift: [-0.5U, 0.5U]
      hole3:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_inner_home
          shift: [-0.5U, 0.5U]
      hole4:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_reachy_num
          shift: [-0.4U, 0.8U]
      hole5:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_inner_num
          shift: [0U, 0.8U]
      hole6:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_thumb_tuck
          shift: [-0.8U, 0.1U]
      hole7:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_thumb_center
          shift: [0.5U, -0.2U]
      hole8:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_thumb_tuck
          shift: [-5.9U, 0.4U]
      hole9:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_thumb_center
          shift: [0.2U, 1U]
      hole10:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_stretch_bottom
          shift: [0.2U, 1U]
      right_text:
        what: ceoloide/utility_text
        params:
          text: "RIGHT SIDE"
          height: 3
          width: 3
        where:
          ref: mirror_matrix_inner_num
          shift: [1.15U, -0.4U]
      model:
        what: ceoloide/utility_text
        params:
          text: "NWSplit60"
          width: 2
          height: 2
        where:
          ref: mirror_matrix_thumb_center
          shift: [1.2U, 0.9U]
      nws_text:
        what: ceoloide/utility_text
        params:
          text: "NWS WAS HERE!"
          width: 2
          height: 2
        where:
          ref: mirror_matrix_thumb_center
          shift: [0.7U, -0.9U]
  plate_left:
    template: kicad8
    outlines:
      main:
        outline: _plate_left
    footprints:
      # Holes
      hole1:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_pinky_home
          shift: [-0.5U, 0.5U]
      hole2:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_middle_home
          shift: [-0.5U, 0.5U]
      hole3:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_inner_home
          shift: [-0.5U, 0.5U]
      hole4:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_outer_num
          shift: [-0.4U, 0.8U]
      hole5:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_inner_num
          shift: [0U, 0.8U]
      hole6:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_thumb_tuck
          shift: [-0.8U, 0.1U]
      hole7:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_thumb_center
          shift: [0.5U, -0.2U]
      hole8:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_thumb_tuck
          shift: [-4.9U, 0.4U]
      hole9:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_thumb_center
          shift: [0.2U, 1U]
      hole10:
        what: ceoloide/mounting_hole_npth
        where:
          ref: matrix_stretch_bottom
          shift: [0.2U, 1U]
  plate_right:
    template: kicad8
    outlines:
      main:
        outline: _plate_right
    footprints:
      hole1:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_pinky_home
          shift: [-0.5U, 0.5U]
      hole2:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_middle_home
          shift: [-0.5U, 0.5U]
      hole3:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_inner_home
          shift: [-0.5U, 0.5U]
      hole4:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_reachy_num
          shift: [-0.4U, 0.8U]
      hole5:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_inner_num
          shift: [0U, 0.8U]
      hole6:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_thumb_tuck
          shift: [-0.8U, 0.1U]
      hole7:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_thumb_center
          shift: [0.5U, -0.2U]
      hole8:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_thumb_tuck
          shift: [-5.9U, 0.4U]
      hole9:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_thumb_center
          shift: [0.2U, 1U]
      hole10:
        what: ceoloide/mounting_hole_npth
        where:
          ref: mirror_matrix_stretch_bottom
          shift: [0.2U, 1U]
